# عنوان داکیومنت کلی
## مقدمه و هدف
در این داکیومنت با هم ساختار inventory رو تعریف میکنیم و بررسی میکنیم چطور میتونیم داخل انسیبل host هامون رو تعریف کنیم.
## ساختار Inventory
دو تا تایپ فایل میتونیم داشته باشیم :
1. `ini`
2. `yml`

از `ym` زمانی استفاده میکنیم که ساختارمون سادست.

ساختار داخل `ini`:
```ini
[all]
host1
host2

[web]
host1

[db]
host2
```

ساختار داخل `yml`:
```yaml
---
all:
	hosts:
		- host1
		- host2
web:
	hosts:
		- host1
db:
	hosts:
		- host2
```

حالا میتونیم برای تمیزی و ساختار مند شدن میتونیم از حالتی استفاده کنیم که یک گروه بسازیم که خودش چندین گروه باشه یعنی:

```ini
[all]
host1
host2
host3

[server:children]
web
db

[web]
host1
host2

[db]
host1
host2
host3

```

انسیبل هنگام اجرا گروه `server` رو بصورت تجمیعی از گروه `web` و `db` میبیند.

نکته جذابش این هست که انسیبل این ساختار را به‌صورت داینامیک مدیریت می‌کند. یعنی اگر بعداً در فایل inventory، هاست جدیدی زیر `web` اضافه کنی، بدون تغییر در گروه `server`, خودبه‌خود عضو `server` هم می‌شود.

# گروه بندی بر اساس Region و دیتاسنتر
ما میتوانیم سرور هامون رو بر اساس موقعیت مکانی و هر چیز دیگری مدیریت کنیم.

برای این کار باید داخل پوشه `inventory` بر اساس چیزی که نیاز داریم گروه بندی رو انجام دهیم، برای مثال اینجا اول بر اساس موقعیت مکانی هاست هامون گروه بندی رو پیاده سازی میکنیم:

```
➜  ansible tree inventory 
inventory
├── reg-e
└── reg-w
```

یک پوشه برای سازماندهی فایل‌های مربوط به سرورهای شرق و غرب ایجاد می‌کنیم، حالا همچنین میتونیم گروه بندی رو افزایش بدیم و بر اساس دیتاسنتر هم گروه بندی کنیم:

```bash
➜  ansible tree inventory               
inventory
├── reg-e
│   ├── hosts_dc1.ini
│   └── hosts_dc4.ini
└── reg-w
    ├── hosts_dc2.ini
    └── hosts_dc3.ini
```

توی این ساختار ما فایل بندی دیتاسنتر رو هم اضافه کردیم و در نهایت باید همه این هاست هارو داخل فایل زیر قرار بدیم: ( در نهایت انسیبل از این فایل استفاده خواهد کرد )

```
hosts_all.ini
```

بصورت زیر :

```
[all:children]
reg-w
reg-e

[reg-w:children]
dc2
dc3

[reg-e:children]
dc1
dc4
```

داخل هر فایل hosts_dcX.ini باید گروه دیتاسنتر را تعریف کنیم، چون انسیبل بر اساس محتوای فایل گروه‌ها را می‌سازد نه براساس اسم فایل یا نام پوشه.

نمونه فایل `hosts_dc3.ini` : 
```
[dc3]
host1
host2
host3
```

این روش به ما این قابلیت رو میده که هر چیزی سر جای خودش هستش و اگر یک چیزی رو بخوایم تغیر بدیمش فقط همون فایل مورد نظر رو تغیر میدیم.

نکته طلایی:
برای کوتاه تر شدن فایل `inventory` میتونیم بصورت زیر هم بنویسیم:
```
[dc3]
host[1:3]
```
## جمع‌بندی
در انسیبل Inventory را می‌توان هم با `ini` نوشت و هم با `yml`. هر دو تنها یک کار انجام می‌دهند: مشخص می‌کنند چه هاست‌هایی زیر مدیریت هستند و این هاست‌ها در چه گروه‌هایی قرار می‌گیرند.

در ادامهٔ کار می‌توان از گروه‌های چندلایه استفاده کرد؛ یعنی با `children` گروه‌هایی ساخت که خودشان مجموعه‌ای از گروه‌های کوچک‌تر هستند. این قابلیت ساختار inventory را مرتب و قابل‌گسترش نگه می‌دهد و به‌صورت داینامیک به‌روزرسانی می‌شود.

برای زیرساخت‌های بزرگ‌تر، پوشه‌بندی inventory کمک می‌کند نظم حفظ شود. معمولاً ابتدا بر اساس Region پوشه‌ها جدا می‌شوند و هر Region نیز شامل فایل‌های مربوط به دیتاسنترهای خودش است. هر دیتاسنتر در فایل خودش تعریف می‌شود و یک فایل مرکزی مانند `hosts_all.ini` فقط نقش اتصال‌دهندهٔ این گروه‌ها را بازی می‌کند.

در نهایت، این روش باعث می‌شود هر بخش از زیرساخت در جای مشخصی قرار بگیرد و هر تغییری فقط همان فایل مرتبط را درگیر کند. نتیجه یک inventory تمیز، خوانا و قابل نگهداری است.
## منابع
[دوره انسیبل مرتضی باشسیز](https://youtu.be/bdYf9Pah1Mw?si=TP3JdAQ81JAOe_uq)
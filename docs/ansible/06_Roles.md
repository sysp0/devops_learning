# توضیح Roles در انسیبل
## مقدمه و هدف
این داکیومنت یک توضیح کلی درباره مفهوم Role در انسیبل ارائه می‌دهد. هدف این است که ساختار و منطق Role شفاف توضیح داده شود تا بتوانیم راحت‌تر از آن استفاده کنیم.
## توضیح Role و پوشه ها
هدفش این است که **همه چیزهایی که برای انجام یک کار نیاز داری** مثل tasks، handlers، templates، files، vars در یک ساختار استاندارد و قابل تکرار قرار بگیرد.

داخل پوشه Roles چندین پوشه دیگری داریم به ازای هر Role ما یک پوشه داریم:
```
➜  ansible tree roles
roles
└── nginx
    ├── default
    │   └── main.yml
    ├── files
    ├── handlers
    │   └── main.yml
    ├── tasks
    │   └── main.yml
    └── vars
        └── main.yml
```

### پوشه `default` 

به عنوان مثال زمانی که میخواهیم متغیر های پیش فرض برای این Role مشخص مون تغیر بدیم داخل این فولدر و داخل فایل `main.yml` تعریف میکنم.

مثلا یک role داریم به نام `nginx` بصورت پیش فرض `https` باید روی پورت 443 باشد ولی ما به دلیل شرایط میخواهم تغیر دهیم برای همین متغیر default_port رو داخل این ذخیره میکنیم روی پورت دلخواه مون.

### پوشه `files`

داخل این پوشه static file هارو قرار میدهیم. برای مثال این پوشه برای موقعی هست که میخواهید کانفیگ سرویس تون بصورت ثابت و استاتیک روی سرور قرار دهید. 

برای مثال شما میخواهید کانفیگ خودتون رو داشته باشید، مثلا برای SSH شما یک فایل کانفیگ ثابت آماده میکنید و توی پوشه `files` قرار میدهید و جایگزین با کانفیگ پیش فرض خواهد شد. داخل این `files` از متغیر ها نمیتوانیم استفاده کنیم برای استفاده از متغیر باید داخل `templates` قرار دهیم.

### پوشه `Templates`

داخل این پوشه میتونیم فایل های کانفیگ مون رو بصورت jinja بنویسیم و از متغیر ها داخلش استفاده کنیمو

در نهایت: هدف این هست بتونیم داخل سیستمی که انسیبل در حال اجرا هست فایل هایی رو به سرور ارسال و جاگذاری بکنیم.

نکته برای مسیر دهی فایل های کانفیگ مون : داخل پوشه `templates` و `files` باید دقیقا مسیر دهی به همون صورتی که باشه که فایل کانفیگ ما روی سرور قرار داره برای مثال برای کانفیگ ssh باید بصورت زیر باشد:

```
➜  nginx tree files   
files
└── etc
    └── ssh -> ssh_config
```

### پوشه `handlers`
این پوشه برای مدیریت سرویس ها به کار میرود. برای مثال شما زمانی که `ssh_config` رو تغیر میدهید نیاز دارید تا یک trigger فراخوانی شود و ssh daemon را `reload` و `restart` بکند.

توی این موارد ما از `handlers` ها استفاده میکنیم. نحو فراخوانی هم جلوتر بررسی میکنیم.

### پوشه `tasks`
تمام کارهایی که قرار هست انجام شود داخل این فولدر قرار میدهیم.

فایل `main.yml` باید وجود داشته باشد و میتوانیم فایل های دیگری هم قرار بدهیم و داخل فایل `main` به ترتیب دلخواه آن ها را اجرا کنیم.
## جمع‌بندی
رول ها در انسیبل یک ساختار منظم و استاندارد است که کمک می‌کند هر سرویس یا پیکربندی را جدا و تمیز مدیریت کنیم.  
هر بخش از Role یک وظیفه مشخص دارد: متغیرهای پیش‌فرض در default، فایل‌های ثابت در files، فایل‌های داینامیک در templates، کارهای اصلی در tasks و عملیات‌های بعد از تغییر در handlers.  
این ساختار باعث می‌شود کار ما مرتب، قابل‌تکرار و قابل‌گسترش باشد و بتوانیم در پروژه‌های مختلف بدون دردسر از آن استفاده کنیم.
## منابع
[دوره انسیبل مرتضی باشسیز](https://youtu.be/S9XUZbRihb4?si=3tFmPVdla5TFwe54)